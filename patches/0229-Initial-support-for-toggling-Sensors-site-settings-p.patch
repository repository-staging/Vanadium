From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: quh4gko8 <88831734+quh4gko8@users.noreply.github.com>
Date: Mon, 19 Jan 2026 14:36:41 +0000
Subject: [PATCH] Initial support for toggling Sensors site settings per-site

---
 .../site_settings/SingleWebsiteSettings.java  | 23 +++++++++++++++++++
 .../browser_ui/site_settings/Website.java     | 15 ++++++++++++
 2 files changed, 38 insertions(+)

diff --git a/components/browser_ui/site_settings/android/java/src/org/chromium/components/browser_ui/site_settings/SingleWebsiteSettings.java b/components/browser_ui/site_settings/android/java/src/org/chromium/components/browser_ui/site_settings/SingleWebsiteSettings.java
index ab6fe6ea49626..7ea5bf86c20a7 100644
--- a/components/browser_ui/site_settings/android/java/src/org/chromium/components/browser_ui/site_settings/SingleWebsiteSettings.java
+++ b/components/browser_ui/site_settings/android/java/src/org/chromium/components/browser_ui/site_settings/SingleWebsiteSettings.java
@@ -681,6 +681,8 @@ public class SingleWebsiteSettings extends BaseSiteSettingsFragment
                 // state as ALLOW in regular mode and BLOCK in incognito. This logic should
                 // be removed when a prompt is implemented for parity with desktop.
                 setUpAutoPictureInPicturePreference(preference);
+            } else if (type == ContentSettingsType.SENSORS) {
+                setUpSensorsPreference(preference);
             } else {
                 setupContentSettingsPreference(
                         preference,
@@ -1579,6 +1581,27 @@ public class SingleWebsiteSettings extends BaseSiteSettingsFragment
                 isOneTime(ContentSettingsType.AUTO_PICTURE_IN_PICTURE));
     }
 
+    @RequiresNonNull({"mSite"})
+    private void setUpSensorsPreference(Preference preference) {
+        BrowserContextHandle browserContextHandle =
+                getSiteSettingsDelegate().getBrowserContextHandle();
+        @ContentSetting
+        @Nullable
+        Integer currentValue =
+                mSite.getContentSetting(browserContextHandle, ContentSettingsType.SENSORS);
+        if (currentValue == null) {
+            currentValue = WebsitePreferenceBridge.isCategoryEnabled(
+                                   browserContextHandle, ContentSettingsType.SENSORS)
+                    ? ContentSetting.ALLOW
+                    : ContentSetting.BLOCK;
+        }
+        // Not possible to embargo SENSORS.
+        setupContentSettingsPreference(preference,
+                currentValue,
+                /* isEmbargoed= */ false,
+                isOneTime(ContentSettingsType.SENSORS));
+    }
+
     @RequiresNonNull({"mSite"})
     private void setUpJavascriptPreference(Preference preference) {
         BrowserContextHandle browserContextHandle = getBrowserContextHandle();
diff --git a/components/browser_ui/site_settings/android/java/src/org/chromium/components/browser_ui/site_settings/Website.java b/components/browser_ui/site_settings/android/java/src/org/chromium/components/browser_ui/site_settings/Website.java
index 7d0cc433c9d22..26e03a7334a8b 100644
--- a/components/browser_ui/site_settings/android/java/src/org/chromium/components/browser_ui/site_settings/Website.java
+++ b/components/browser_ui/site_settings/android/java/src/org/chromium/components/browser_ui/site_settings/Website.java
@@ -343,6 +343,21 @@ public final class Website implements WebsiteEntry {
                                 SessionModel.DURABLE);
                 setPermissionInfo(permissionInfo);
             }
+        } else if (type == ContentSettingsType.SENSORS) {
+            // The Sensors permission is defaulted to allowed/denied based on the
+            // incognito status. When the user explicitly sets the permission for the first time, no
+            // PermissionInfo object has been created for Sensors yet. This logic
+            // should be removed when a prompt is implemented for parity with desktop.
+            if (permissionInfo == null) {
+                permissionInfo =
+                        new PermissionInfo(
+                                type,
+                                mOrigin.getOrigin(),
+                                /* embedder= */ null,
+                                /* isEmbargoed= */ false,
+                                SessionModel.DURABLE);
+                setPermissionInfo(permissionInfo);
+            }
         }
         if (permissionInfo != null) {
             permissionInfo.setContentSetting(browserContextHandle, value);
