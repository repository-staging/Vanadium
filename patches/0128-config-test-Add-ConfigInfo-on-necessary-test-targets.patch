From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: quh4gko8 <88831734+quh4gko8@users.noreply.github.com>
Date: Thu, 8 Feb 2024 15:22:13 +0000
Subject: [PATCH] config: test: Add ConfigInfo on necessary test targets

---
 chrome/android/chrome_public_apk_tmpl.gni |  6 ++++++
 content/shell/android/BUILD.gn            |  7 +++++++
 net/android/BUILD.gn                      |  4 ++++
 testing/test.gni                          | 16 ++++++++++++++++
 4 files changed, 33 insertions(+)

diff --git a/chrome/android/chrome_public_apk_tmpl.gni b/chrome/android/chrome_public_apk_tmpl.gni
index 7772f678b898b..ae4bc8048b73f 100644
--- a/chrome/android/chrome_public_apk_tmpl.gni
+++ b/chrome/android/chrome_public_apk_tmpl.gni
@@ -786,5 +786,11 @@ template("chrome_public_test_apk_tmpl") {
     target_type = "instrumentation_test_apk"
     forward_variables_from(invoker, TESTONLY_AND_VISIBILITY)
     forward_variables_from(invoker, "*", TESTONLY_AND_VISIBILITY)
+    if (!defined(srcjar_deps)) {
+      srcjar_deps = []
+    }
+    srcjar_deps += [
+      "//vanadium/android_config:configinfo_srcjar_apk",
+    ]
   }
 }
diff --git a/content/shell/android/BUILD.gn b/content/shell/android/BUILD.gn
index d4dfdf1d080c3..74caf5631cde3 100644
--- a/content/shell/android/BUILD.gn
+++ b/content/shell/android/BUILD.gn
@@ -204,6 +204,13 @@ template("content_shell_apk_tmpl") {
       "//ui/android:ui_java",
       "//ui/gl:gl_headers",
     ]
+    if (!defined(srcjar_deps)) {
+      srcjar_deps = [
+      ]
+    }
+    srcjar_deps += [
+      "//vanadium/android_config:configinfo_srcjar_apk",
+    ]
     loadable_modules = [ "$root_out_dir/libchrome_crashpad_handler.so" ]
   }
 }
diff --git a/net/android/BUILD.gn b/net/android/BUILD.gn
index bb8c0ff76784e..defec20fae53d 100644
--- a/net/android/BUILD.gn
+++ b/net/android/BUILD.gn
@@ -194,6 +194,10 @@ android_apk("net_test_support_apk") {
   apk_name = "ChromiumNetTestSupport"
   shared_libraries = [ ":net_java_test_native_support" ]
   srcjar_deps = [ ":net_java_test_native_support__jni_registration" ]
+
+  srcjar_deps += [
+    "//vanadium/android_config:configinfo_srcjar_apk",
+  ]
 }
 
 android_resources("net_unittests_apk_resources") {
diff --git a/testing/test.gni b/testing/test.gni
index 288236a7b1585..40d0417297fe4 100644
--- a/testing/test.gni
+++ b/testing/test.gni
@@ -621,6 +621,14 @@ template("test") {
                 ] + _apk_specific_vars + _wrapper_script_vars +
                 TESTONLY_AND_VISIBILITY)
 
+        if (!defined(srcjar_deps)) {
+          srcjar_deps = [
+          ]
+        }
+        srcjar_deps += [
+          "//vanadium/android_config:configinfo_srcjar_apk",
+        ]
+
         # Use a crate name that avoids creating a warning due to double
         # underscore (ie. `__`).
         crate_name = _library_crate_name
@@ -656,6 +664,14 @@ template("test") {
           srcjar_deps = [ "${shared_library}__jni_registration" ]
         }
 
+        if (!defined(srcjar_deps)) {
+          srcjar_deps = [
+          ]
+        }
+        srcjar_deps += [
+          "//vanadium/android_config:configinfo_srcjar_apk",
+        ]
+
         if (defined(invoker.deps)) {
           deps = invoker.deps
         } else {
